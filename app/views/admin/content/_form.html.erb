<%= hidden_field_tag "user_textfilter", current_user.text_filter_name %>

<div id="autosave"><%= hidden_field_tag("article[id]", @article.id) if @article.present? %></div>
<div id="article_keywords_auto_complete" class="auto_complete"></div>

<div class='row'>
  <div class='col-md-12'>
    <div class='pull-right'>
      <%= link_to(t('.cancel'), {action: 'index'}, {class: 'btn btn-default'}) %>
      <span id='preview_link'>
        <%= link_to(t(".preview"), {controller: '/articles', action: 'preview', id: @article.id}, {target: 'new', class: 'btn btn-default'}) if @article.id %>
      </span>
      <input id='save_draft' type="submit" value="<%= t('.save_as_draft') %>" name="article[draft]" class='btn btn-default' />
      <!-- Button trigger modal -->
      <button class="btn btn-success" data-toggle="modal" data-target="#publishOptions">
        <%= publish_or_save %>
      </button>    
    </div>  
  </div>
  
</div>
<div class='row'>
  <div class='col-md-8 col-md-offset-2' style='padding-top: 20px'>
    <%= error_messages_for 'article' %>    
    
  </div>
</div>
<div class='row'>
  <div class='col-md-2' id='quicktags-block'>
    <div id='quicktags' style='padding-top: 10px;' class='pull-right'>
      <script type="text/javascript">edToolbar('article_body_and_extended', '<%= @article.text_filter %>');</script>
      <%#= render 'admin/shared/macros' %>
      
    </div>
    
  </div>
  <div class='col-md-8'>
      <div>
        <%= text_field 'article', 'title', :class => 'form-control', :placeholder => t('.title') %>
      </div>
      <%= render('images', { :images => @images}) unless @images.empty? %>
  
      <div id="editor">
        <i class='glyphicon glyphicon-picture'></i> 
        <span id='image-link'>
          <%= toggle_element('carousel-wrapper', t('.images')) %>
        </span>

        <div id='simple_editor'>
          <%= text_area('article', 'body_and_extended', {:class => 'form-control ', :height => '360px', placeholder: t('.type_your_post'), :"data-widearea" => "enable"}) %>
          <script type="text/javascript">
          if (document.getElementById('article_id').value == "") {
            wideArea().clearData("#article_body_and_extended");;
          } else {
            adaptiveheight($("#article_body_and_extended"));
          }
          wideArea();
          </script>
        </div>
      </div> <!-- End of editor -->
      
    </div>

        <div id="editor">
          <i class='icon icon-media'></i> <span id='image-link'>
            <a href="#" onclick="$('#carousel-wrapper').toggle(); return false"><%= t('.images')%></a>
          </span>
          <div id='quicktags'>
            <script type="text/javascript">edToolbar('article_body_and_extended', '<%= @article.text_filter %>');</script>
          </div>

<!-- Modal -->
<div class="modal fade" id="publishOptions" tabindex="-1" role="dialog" aria-labelledby="publishOptions" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel"><%= t('.publish') %>
        <%= submit_tag(t(".publish"), :class => 'btn btn-success pull-right') %>&nbsp;
        </h2>
      </div>
      <div class="modal-body">
        <div class='well'>
          <h4><%= t(".categories") %></h4>
          <%= render 'categories' %>
        </div>
        <div class='well'>
          <h4><%= t(".tags") %></h4>
          <div class='form-group'>
            <%= text_field 'article', 'keywords', {:autocomplete => 'off', :class => 'form-control'} %>
          </div>
          <p class='alert alert-warning'><%=t(".tags_explaination") %></p>
          <%#= auto_complete_field 'article_keywords', { :url => { :action => "auto_complete_for_article_keywords"}, :method => 'get', :tokens => ','}%>		
  
        </div>
        <%= get_post_types %>
        
        <!-- Start of publish settings -->
        <div class='well'>
          <fieldset>
            <legend><%= t(".publish_settings") %></legend>
    
            <!-- Start of status -->
            <div class='control-group'>
              <p>
                <%= t(".status") %>: <strong><%= _(@article.state.to_s.downcase) %></strong>
                <%= toggle_element('status') %>
              </p>
              <div id='status' class='collapse'>
                <label for="article_published" class='checkbox'>
                  <%= check_box 'article', 'published'  %>
                  <%= t(".published") %>
                </label>
                <p><span class='btn btn-xs'>
                  <a href="#" class="extoggle status">OK</a>
                </span></p>
              </div>
            </div>
            <div class='form-group *'>
              <p><%= t(".allowed_comments_and_trackbacks", allow_comment: content_tag(:strong, get_feedback_status(@article.allow_comments)), allow_trackback: content_tag(:strong, get_feedback_status(@article.allow_pings))) %>
            <a href="#" class="extoggle conversation" ><%= t('.change')%></a>
            <div id='conversation' style='display: none'>
              <label for="article_allow_pings" class='checkbox'>
                <%= check_box 'article', 'allow_pings' %>
                <%= t(".allow_trackbacks") %>
              </label>
              <label for="article_allow_comments" class='checkbox'>
                <%= check_box 'article', 'allow_comments' %>
                <%= t(".allow_comments") %>
              </label>
              <p><span class='btn btn-xs'>
                <a href="#" class="extoggle conversation"><%= t('.ok')%></a>
              </span></p>
            </div>
          </div>
          <div class='form-group *'>
            <p><%= t(".published") %> <strong><%= publish_now_or_already_published @article %></strong>
            <a href="#" class="extoggle publish" ><%= t('.change')%></a>
            </p>
            <div id='publish' class='input-group' style='display: none;'>
              <%= text_field 'article', 'published_at', :class => "datepicker" %>
              <p><span class="btn btn-xs">
            <a href="#" class="extoggle status"><%= t('.ok')%></a>
              </span></p>
            </div>
            <!-- End of feedback settings -->

          </div>
          <div class='form-group *'>
            <p><%= t(".visibility") %>: <strong><%= @article.password.nil? || @article.password.empty? ? t(".public") : t(".protected") %></strong>
            <a href="#" class="extoggle visibility" ><%= t('.change')%></a>
            </p>
            <div id='visibility' style='display: none'>
              <label for="article_password"><%= t(".password") %>
    <div class='separator'>
      <h4><%= _("Excerpt") %></h4>
      <%= text_area 'article', 'excerpt', {:height => '150', :class => 'input-block-level', :rows => '5'} %>
      <span class='help-block'><%=_("Excerpts are post summaries that show only on your blog homepage and wonâ€™t appear on the post itself") %></span>
    </div>

    <div class='well'>
      <fieldset>
        <legend><%= _("Publish settings") %></legend>
        <div class='form-group *'>
          <p><%= _("Status") %>: <strong><%= _(@article.state.to_s.downcase) %></strong> <%= toggle_element 'status' %></p>
          <div id='status' class="collapse">
            <label for="article_published" class='checkbox'>
              <%= check_box 'article', 'published'  %>
              <%= _("Published") %>
            </label>
            <%= submit_tag 'Ok', :class => "old_ok_button status" %>
            <%#= ok_button('status') %>
          </div>
        </div>
        <div class='form-group *'>
          <p><%= _("Comments are %s and trackbacks are %s", content_tag(:strong, get_feedback_status(@article.allow_comments)), content_tag(:strong, get_feedback_status(@article.allow_pings))) %>
          <%= toggle_element 'conversation' %></p>
          <div id='conversation' class="collapse">
            <label for="article_allow_pings" class='checkbox'>
              <%= check_box 'article', 'allow_pings' %>
              <%= _("Allow trackbacks") %>
            </label>
            <label for="article_allow_comments" class='checkbox'>
              <%= check_box 'article', 'allow_comments' %>
              <%= _("Allow comments") %>
            </label>
            <p><span class='btn btn-xs'><%= toggle_element 'conversation', "OK" %></span></p>
          </div>
        </div>
        <div class='form-group *'>
          <p><%= _("Published") %> <strong><%= publish_now_or_already_published @article %></strong> <%= toggle_element 'publish' %></p>
          <div id='publish' class='collapse input-group'>
            <%= text_field 'article', 'published_at', :class => 'datepicker' %>
            <%= submit_tag 'Ok', :class => "old_ok_button publish" %>
            <%#= ok_button('publish') %>
          </div>

        </div>
        <div class='form-group *'>
          <p><%= _("Visibility") %>: <strong><%= @article.password.nil? || @article.password.empty? ? _("public") : _("protected") %></strong> <%= toggle_element 'visibility' %></p>
          <div id='visibility' class="collapse">
            <label for="article_password"><%= _("Password:") %>
              <%= password_field :article, :password, :class => 'col-md-10' %>
            </label>
            <p><span class="btn btn-xs">
            <a href="#" class="extoggle status"><%= t('.ok')%></a>
            </span></p>
          </div>
        </div>
        <div class='form-group *'>
          <%= t(".permalink") %>:
          <a href="#" class="extoggle permalink"><%= t('.change')%></a>
          <div class='inputs-list' id='permalink' style='display: none'>
            <%= text_field 'article', 'permalink', {class: 'col-md-10'} %>
            <p><span class="btn btn-xs">
            <a href="#" class="extoggle status"><%= t('.ok')%></a>
            </span></p>
          </div>
        </div>
        <div class='form-group *'>
          <%= t(".article_filter") %>: <strong id='text_filter_placeholder'><%= _("#{@article.text_filter.description}") %></strong>
          <a href="#" class="extoggle text_filter"><%= t('.change')%></a>

          <div id='text_filter' style='display: none'>
            <select name="article[text_filter]" id="article_text_filter">
              <%= options_for_select text_filter_options, @article.text_filter %>
            </select>
            <p><span class="btn btn-xs">
              <a href="#" onclick="Element.toggle('status'); return false"><%= t('.ok')%></a>
            </span></p>
          </div>
        </div>
      </fieldset>
    </div>
    <div class='pull-right'>
      <%- if @article.id.present? && @article.state.to_s.downcase != 'draft' %>
        <%- if current_user.admin? || current_user.id == @article.user_id %>
          <%= link_to(t(".delete"), { action: 'destroy', id: @article.id }, data: {confirm: t(".are_you_sure")}, method: :post, class: 'btn danger', title: t(".delete_content")) %>
        <%- end %>
      <%- end %>
      <span id='destroy_link'><%= link_to_destroy_draft @article %></span>
      <input id='save_draft' type="submit" value="<%= t('.save_as_draft') %>" name="article[draft]" class='btn info' />
      <%= submit_tag(t(".publish"), :class => 'btn btn-primary') %>
    </div>

  </div>
</div>

<div class='col-md-3'>
  <div class='well'>
    <h4><%= t(".categories") %></h4>
    <%= render 'categories' %>
  </div>
  <div class='well'>
    <h4><%= t(".tags") %></h4>
    <div class='class'>
      <%= text_field 'article', 'keywords', {:autocomplete => 'off', :class => 'input-block-level'} %>
      <p class='alert alert-warning'><%=t(".tags_explaination") %></p>
    </div>
    <%#= auto_complete_field 'article_keywords', { :url => { :action => "auto_complete_for_article_keywords"}, :method => 'get', :tokens => ','}%>

  </div>
  <%= get_post_types %>
</div>
